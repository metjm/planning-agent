# Claude-only workflow configuration with a distinct implementation reviewer.
# This configuration enables session persistence for planning->revision continuity.

agents:
  claude:
    command: "claude"
    args:
      - "-p"
      - "--output-format"
      - "stream-json"
      - "--verbose"
      - "--dangerously-skip-permissions"
    allowed_tools:
      - "Read"
      - "Glob"
      - "Grep"
      - "Write"
      - "Edit"
      - "Bash"
      - "WebSearch"
      - "WebFetch"
      - "Skill"
      - "Task"
    # Enable conversation persistence for planning->revision continuity (Claude-only feature)
    session_persistence:
      enabled: true
      strategy: conversation_resume
  claude-reviewer:
    command: "claude"
    args:
      - "-p"
      - "--output-format"
      - "stream-json"
      - "--verbose"
      - "--dangerously-skip-permissions"
    allowed_tools:
      - "Read"
      - "Glob"
      - "Grep"
      - "Bash"

workflow:
  planning:
    agent: claude
    # Note: max_turns applies to BOTH planning AND revision phases.
    # Set high enough for complex plans that may require multiple revision cycles.
    max_turns: 200

  reviewing:
    agents:
      - claude
      - agent: claude
        id: claude-practices
        prompt: |
          Focus your review on repository practices and code reuse:
          - Does the plan follow existing patterns and conventions in the codebase?
          - Are there existing utilities, helpers, or abstractions that should be reused?
          - Does the plan introduce unnecessary code duplication?
          - Are new abstractions justified, or should existing ones be extended?
          - Does the proposed structure align with the project's module organization?
    aggregation: any_rejects

  # Note: Revision phase uses the planning agent automatically.
  # With session_persistence enabled, revision resumes the planning session context.

# Failure handling policy (uses defaults)
# failure_policy:
#   max_retries: 2
#   backoff_secs: 5
#   on_all_reviewers_failed: abort

# Implementation workflow configuration (requires a distinct reviewer agent).
implementation:
  enabled: true
  implementing:
    agent: claude
  reviewing:
    agent: claude-reviewer
