# Multi-Agent Workflow Configuration
# Copy this file to workflow.yaml to enable multi-agent orchestration

# Agent definitions
# Each agent specifies the CLI command and arguments to use
agents:
  claude:
    command: "claude"
    args:
      - "-p"
      - "--output-format"
      - "stream-json"
      - "--verbose"
      - "--dangerously-skip-permissions"
    allowed_tools:
      - "Read"
      - "Glob"
      - "Grep"
      - "Write"
      - "Edit"
      - "WebSearch"
      - "WebFetch"
      - "Skill"
      - "Task"
    # Optional: Enable session persistence for planning->revision session continuity.
    # This is a Claude-only feature. When enabled, revision resumes the planning session.
    # session_persistence:
    #   enabled: true
    #   strategy: session_id

  codex:
    command: "codex"
    args:
      - "exec"
      - "--json"
    allowed_tools: []

  gemini:
    command: "gemini"
    args:
      - "-p"
      - "--output-format"
      - "json"
    allowed_tools: []

# Workflow phase configuration
workflow:
  # Planning phase - which agent creates the initial plan
  # IMPORTANT: planning.max_turns applies to BOTH planning AND revision phases.
  # Set high enough for complex plans that may require multiple revision cycles.
  planning:
    agent: claude
    max_turns: 200

  # Reviewing phase - can use multiple agents for parallel review
  reviewing:
    agents:
      - claude
      - codex
    # Aggregation mode determines when revision is needed:
    # - any_rejects: If ANY reviewer rejects, needs revision (default, strictest)
    # - all_reject: Only if ALL reviewers reject
    # - majority: If majority rejects
    aggregation: any_rejects

  # Note: Revision phase uses the planning agent automatically.
  # When the planning agent has session_persistence enabled (Claude only),
  # revision resumes the planning session, providing context continuity.

# Failure handling policy (optional - defaults shown)
# Controls how transient failures and recovery are handled
failure_policy:
  max_retries: 2           # Maximum retry attempts for transient failures
  backoff_secs: 5          # Backoff multiplier in seconds between retries
  # Action when all reviewers fail after retries:
  # - abort: Stop workflow with error (default)
  # - save_state: Save state for later recovery in TUI mode
  # - continue_without_review: Proceed to revision phase without reviews
  on_all_reviewers_failed: abort
